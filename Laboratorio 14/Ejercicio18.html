<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Composición: Carrito y Productos</title>
</head>
<body>
  <h2>Carrito de compras (Composición)</h2>

  <h3>Agregar producto</h3>
  <label for="nombreProd">Nombre:</label>
  <input type="text" id="nombreProd" placeholder="Ej: Mouse">

  <label for="precioProd">Precio:</label>
  <input type="number" id="precioProd" step="0.01" placeholder="Ej: 50">

  <label for="cantProd">Cantidad:</label>
  <input type="number" id="cantProd" step="1" value="1">

  <button onclick="agregarProductoAlCarrito()">Agregar al carrito</button>

  <h3>Resumen del carrito</h3>
  <pre id="resumenCarrito">(sin productos)</pre>
  <p><strong>Total:</strong> <span id="totalCarrito">0.00</span></p>

  <p id="mensaje" style="color:red;"></p>

  <script>
    // ===================== MODELO =====================

    class Producto {
      constructor(nombre, precio, cantidad = 1) {
        this.nombre = nombre;
        this.precio = precio;
        this.cantidad = cantidad;
      }

      getSubtotal() {
        return this.precio * this.cantidad;
      }
    }

    class Carrito {
      constructor() {
        // composición: el carrito CONTIENE productos
        this.productos = []; // array de objetos Producto
      }

      agregarProducto(producto) {
        // Se podría mejorar acumulando cantidades si ya existe el producto
        this.productos.push(producto);
      }

      calcularTotal() {
        return this.productos.reduce(
          (acc, prod) => acc + prod.getSubtotal(),
          0
        );
      }

      mostrarResumen() {
        if (this.productos.length === 0) {
          return "(carrito vacío)";
        }

        let lineas = this.productos.map((p, idx) => {
          return (
            `${idx + 1}. ${p.nombre} ` +
            `| precio: ${p.precio.toFixed(2)} ` +
            `| cant: ${p.cantidad} ` +
            `| subtotal: ${p.getSubtotal().toFixed(2)}`
          );
        });

        return lineas.join("\n");
      }
    }

    // ===================== CONTROLADOR / UI =====================

    const carrito = new Carrito();

    function actualizarVista() {
      document.getElementById("resumenCarrito").textContent =
        carrito.mostrarResumen();

      document.getElementById("totalCarrito").textContent =
        carrito.calcularTotal().toFixed(2);
    }

    function setMensaje(msg) {
      document.getElementById("mensaje").textContent = msg;
    }

    function agregarProductoAlCarrito() {
      const nombre = document.getElementById("nombreProd").value.trim();
      const precio = parseFloat(document.getElementById("precioProd").value);
      const cant = parseInt(document.getElementById("cantProd").value);

      setMensaje("");

      if (!nombre) {
        setMensaje("El nombre del producto es obligatorio.");
        return;
      }

      if (isNaN(precio) || precio <= 0) {
        setMensaje("El precio debe ser un número mayor a 0.");
        return;
      }

      if (isNaN(cant) || cant <= 0) {
        setMensaje("La cantidad debe ser un entero mayor a 0.");
        return;
      }

      const producto = new Producto(nombre, precio, cant);
      carrito.agregarProducto(producto);

      actualizarVista();

      // Opcional: limpiar inputs
      document.getElementById("nombreProd").value = "";
      document.getElementById("precioProd").value = "";
      document.getElementById("cantProd").value = 1;
    }

    // estado inicial
    actualizarVista();
  </script>
</body>
</html>
